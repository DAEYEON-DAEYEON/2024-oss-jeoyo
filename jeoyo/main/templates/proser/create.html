{% extends 'common/base.html' %}

{% block title %} ì €ìš”ğŸ¤š {% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/login.css">
<link rel="stylesheet" href="/static/css/proser/create.css">
{% endblock %}


{% block content %}

<div id="explanation" class="contents main_contents">
    <div class="exp-box">
        <div class="exp-content info_box">
            <div class="exp-text">
                <!-- ì—¬ê¸°ë„ ë¬¼ê±´/ì„œë¹„ìŠ¤ êµ¬ë¶„í•´ì„œ ifë¬¸ìœ¼ë¡œ ë°”ê¾¸ê¸° (ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ ìƒì„± í›„) -->
                <h3>
                    {% if op == '0' %}
                    ë¬¼ê±´ğŸ“¦
                    {% elif op == '1' %}
                    ì„œë¹„ìŠ¤ğŸ™‡
                    {% endif %}
                    </h3>
                <form onSubmit="return create(this);" enctype="multipart/form-data">
                    {% csrf_token %}
                    <!-- ë¬¼ê±´ì¸ì§€ ì„œë¹„ìŠ¤ì¸ì§€ êµ¬ë¶„ -->
                    <input type="hidden" name="option" value={{ op }}>
                    <!-- ì‘ì„±ì ì•„ì´ë”” -->
                    {% if request.session.id %}
                    {% endif %}
                    <input type="hidden" name="uid" value={{request.session.id}}>

                    <label name="name">
                    {% if op == '0' %}ì œí’ˆ{% elif op == '1' %}ì„œë¹„ìŠ¤{% endif %}ëª…</label>
                    <input type="text" name="name">

                    <label name="des">
                    {% if op == '0' %}ì œí’ˆ{% elif op == '1' %}ì„œë¹„ìŠ¤{% endif %}ì„¤ëª…</label>
                    <textarea type="textarea" name="des"></textarea>
                    
                    <label name="maxval">ìµœì†Œê¸ˆì•¡ì„¤ì •</label>
                    <input type="number" name="maxval">
                    
                    <label name="img">
                    {% if op == '0' %}ì œí’ˆ{% elif op == '1' %}ì„œë¹„ìŠ¤{% endif %}ì´ë¯¸ì§€</label>
                    <input type="file" name="img" id="img">
                    
                    <button class="custom-btn btn-4"><span>{% if op == '0' %}ì œí’ˆ{% elif op == '1' %}ì„œë¹„ìŠ¤{% endif %} ì—…ë¡œë“œ</span></button>
                </form>
            </div>
            <!-- <img src="/static/img/product.png" alt="" class="exp-imgs"> -->
        </div>
        <div class="exp-content img_wrap" id="img_wrap">
            <img id="imgon" />
        </div>
    </div>
</div>

{% endblock %}

<!-- footer -->

{% block extra_script %} 
<script>
    //ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
    var sel_file;
 
    $(document).ready(function() {
        $("#img").on("change", handleImgFileSelect);
    });
 
    function handleImgFileSelect(e) {
        
        const box = document.querySelector(".info_box");
        box.style.maxWidth = "500px";
        
        const imgbox = document.getElementById('img_wrap');
        imgbox.style.maxWidth = "500px";
        imgbox.style.display = "flex";

        
        
        var files = e.target.files;
        var filesArr = Array.prototype.slice.call(files);
 
        var reg = /(.*?)\/(jpg|jpeg|png|bmp)$/;
 
        filesArr.forEach(function(f) {
            if (!f.type.match(reg)) {
                alert("í™•ì¥ìëŠ” ì´ë¯¸ì§€ í™•ì¥ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                return;
            }
 
            sel_file = f;
 
            var reader = new FileReader();
            reader.onload = function(e) {
                $("#imgon").attr("src", e.target.result);
            }
            reader.readAsDataURL(f);
        });
    }
</script>

<script>
    function create(obj) {
      if (!obj.name.value) {
        alert("ì œí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return false;
      }  
        
     if (!obj.des.value) {
        alert("ì œí’ˆì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return false;
      } 
        
      if (!obj.maxval.value) {
        alert("ìµœì†Œê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return false;
      }
        
      var formData = new FormData();
      formData.append('name', obj.name.value);
      formData.append('des', obj.des.value);
      formData.append('maxval', obj.maxval.value);
      formData.append('option', obj.option.value);
      formData.append('uid', obj.uid.value);
      formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
      formData.append('img', obj.img.files[0]);

      $.ajax({
        type: 'POST',
        url: 'https://g-oss-jeoyo-qrxlf.run.goorm.site/api/Service/',
        data: formData,
        processData: false,
        contentType: false,
        success: function (ajax_data) {
            //í•´ë‹¹ ë¦¬ìŠ¤íŠ¸ë¡œ ì´ë™í•˜ë„ë¡ ë³€ê²½
          window.location.href = '/proser/list?op={{op}}';
        },
        error: function (xhr, status, error) {
            alert(status, error); 
        }
      });
      return false;
    }

</script>

{% endblock %}